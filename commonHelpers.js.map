{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import axios from 'axios';\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nconst PIXABAY_API_KEY = '42114323-50c2b50fedad4076dc7ba42b5';\nconst BASE_URL = 'https://pixabay.com';\nconst DEFAULT_PER_PAGE = 15;\n\nconst PIXABAY_BASE_API = axios.create({\n    baseURL: BASE_URL,\n});\n\nconst refs = {\n    form: document.querySelector('#form'),\n    input: document.querySelector('.input'),\n    container: document.querySelector('.container'),\n    loading: document.querySelector('.loading'),\n    loadMore: document.querySelector('#load-more'),\n};\n\nconst lightbox = new SimpleLightbox('.container a');\n\nlet page = 1;\nlet lastQuery = '';\nlet allPhotos = [];\n\nrefs.form.addEventListener('submit', e => {\n    e.preventDefault(e);\n\n    const query = getCurrentQuery();\n\n    if (!query.trim()) {\n        return;\n    }\n\n    resetQueryState();\n    clearContainer();\n\n    lastQuery = query;\n\n    handleQuerySearch(query, page);\n});\n\nrefs.loadMore.addEventListener('click', () => {\n    if (!lastQuery.trim()) {\n        return;\n    }\n\n    page = page + 1;\n\n    handleQuerySearch(lastQuery, page);\n});\n\nasync function handleQuerySearch(query, page) {\n    setLoadingVisibility(true);\n    setLoadMoreVisibility(false);\n\n    let showMore = true;\n\n    try {\n        showMore = await handlePhotos(query, page);\n    } catch (e) {\n        onFetchError();\n    }\n\n    setLoadingVisibility(false);\n    setLoadMoreVisibility(showMore);\n\n    form.reset();\n}\n\nasync function handlePhotos(query, page) {\n    const { photos, total } = await getPhotos(query, page);\n\n    allPhotos.push(...photos);\n\n    if (photos.length === 0) {\n        clearContainer();\n        onEmptyResults();\n        return false;\n    }\n\n    appendPhotos(photos);\n\n    if (page !== 1) {\n        const height = getPhotoHeight();\n        window.scrollBy({\n            top: height * 2,\n            behavior: 'smooth',\n        });\n    }\n\n    if (total === allPhotos.length) {\n        if (page !== 1) {\n            onLastCollection();\n        }\n\n        return false;\n    }\n\n    lightbox.refresh();\n\n    return true;\n}\n\nasync function getPhotos(query, page) {\n    const config = getPixabayPhotosQueryConfig(query, page);\n\n    const response = await PIXABAY_BASE_API.get('api/', config);\n\n    return {\n        photos: response.data.hits,\n        total: response.data.totalHits,\n    };\n}\n\nfunction getPixabayPhotosQueryConfig(query, page = 1) {\n    return {\n        params: {\n            key: PIXABAY_API_KEY,\n            image_type: 'photo',\n            orientation: 'horizontal',\n            safesearch: true,\n            q: query,\n            per_page: DEFAULT_PER_PAGE,\n            page,\n        },\n    };\n}\n\nfunction onFetchError() {\n    iziToast.error({\n        title: 'Sorry, something went wrong.',\n    });\n}\n\nfunction onLastCollection() {\n    iziToast.info({\n        title: \"We're sorry, but you've reached the end of search results.\",\n    });\n}\n\nfunction onEmptyResults() {\n    iziToast.error({\n        title: 'Sorry, there are no images matching your search query. Please try again!',\n    });\n}\n\nfunction appendPhotos(photos) {\n    const photoNodes = photos.map(getPhotoNode);\n\n    refs.container.append(...photoNodes);\n}\n\nfunction getPhotoNode({\n    webformatURL,\n    largeImageURL,\n    tags,\n    likes,\n    views,\n    comments,\n    downloads,\n}) {\n    const photoNode = document.createElement('a');\n\n    photoNode.href = largeImageURL;\n\n    photoNode.innerHTML = `\n    <div class=\"card\">\n        <img src=\"${webformatURL}\" alt=\"${tags}\">\n        <ul class=\"photo_details\">\n            <li>\n                <span class=\"photo_details_paragraph\">Likes</span><br>\n                <span>${likes}</span>\n            </li>\n            <li>\n                <span class=\"photo_details_paragraph\">Views</span><br>\n                <span>${views}</span>\n            </li>\n            <li>\n                <span class=\"photo_details_paragraph\">Comments</span><br>\n                <span>${comments}</span>\n            </li>\n            <li>\n                <span class=\"photo_details_paragraph\">Downloads</span><br>\n                <span>${downloads}</span>\n            </li>\n        </ul>\n    </div>\n    `;\n\n    return photoNode;\n}\n\nfunction setLoadingVisibility(isLoading) {\n    setNodeVisibility(refs.loading, isLoading);\n}\n\nfunction setLoadMoreVisibility(showLoadMore) {\n    setNodeVisibility(refs.loadMore, showLoadMore);\n}\n\nfunction setNodeVisibility(node, visibility) {\n    if (visibility) {\n        node.style.display = 'block';\n        return;\n    }\n\n    node.style.display = 'none';\n}\n\nfunction getPhotoHeight() {\n    const photoNode = document.querySelector('.card');\n\n    return photoNode.getBoundingClientRect().height;\n}\n\nfunction getCurrentQuery() {\n    return form.elements.query.value;\n}\n\nfunction clearContainer() {\n    refs.container.innerHTML = '';\n}\n\nfunction resetQueryState() {\n    lastQuery = '';\n    page = 1;\n    allPhotos = [];\n}\n"],"names":["PIXABAY_API_KEY","BASE_URL","DEFAULT_PER_PAGE","PIXABAY_BASE_API","axios","refs","lightbox","SimpleLightbox","page","lastQuery","allPhotos","query","getCurrentQuery","resetQueryState","clearContainer","handleQuerySearch","setLoadingVisibility","setLoadMoreVisibility","showMore","handlePhotos","onFetchError","photos","total","getPhotos","onEmptyResults","appendPhotos","height","getPhotoHeight","onLastCollection","config","getPixabayPhotosQueryConfig","response","iziToast","photoNodes","getPhotoNode","webformatURL","largeImageURL","tags","likes","views","comments","downloads","photoNode","isLoading","setNodeVisibility","showLoadMore","node","visibility"],"mappings":"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"}